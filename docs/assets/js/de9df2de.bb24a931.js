"use strict";(self.webpackChunkzhuddan_github_io=self.webpackChunkzhuddan_github_io||[]).push([[4680],{9266:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"mini/auth","title":"\u5fae\u4fe1\u767b\u5f55\u6388\u6743\u5904\u7406","description":"\u53c2\u8003\u7f51\u9875\u6388\u6743","source":"@site/archived/mini/auth.md","sourceDirName":"mini","slug":"/mini/auth","permalink":"/docs/mini/auth","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"To be Improved","permalink":"/docs/tags/to-be-improved"}],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"tags":["To be Improved"]},"sidebar":"archived","previous":{"title":"\u767b\u5f55\u903b\u8f91\u5904\u7406","permalink":"/docs/mini/login"},"next":{"title":"\u6742\u9879","permalink":"/docs/category/\u6742\u9879"}}');var s=t(6070),o=t(2790);const a={sidebar_position:7,tags:["To be Improved"]},i="\u5fae\u4fe1\u767b\u5f55\u6388\u6743\u5904\u7406",c={},d=[];function h(e){const n={a:"a",code:"code",h1:"h1",header:"header",mermaid:"mermaid",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u5fae\u4fe1\u767b\u5f55\u6388\u6743\u5904\u7406",children:"\u5fae\u4fe1\u767b\u5f55\u6388\u6743\u5904\u7406"})}),"\n",(0,s.jsxs)(n.p,{children:["\u53c2\u8003",(0,s.jsx)(n.a,{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",children:"\u7f51\u9875\u6388\u6743"})]}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TD;\n    A[\u5f00\u59cb] --\x3e B[\u8fdb\u5165\u7f51\u9875]\n    B --\x3e C{location.href\u5426\u5305\u542bcode?}\n    C --\x3e|\u662f| D[\u63d0\u4ea4code\u7ed9\u5f00\u53d1\u8005\u540e\u53f0]\n    C --\x3e|\u5426| E[\u8df3\u8f6c\u5fae\u4fe1\u6388\u6743]\n    D --\x3e F[\u7ed3\u675f]\n    E --\x3e B[\u8fdb\u5165\u7f51\u9875]"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"/**\n * @description \u5fae\u4fe1\u6388\u6743\n */\nexport function wxAuth() {\n  // \u5f53\u524d\u5730\u5740\n  const currentUrl = new URL(window.location.href)\n  // \u53c2\u6570\n  const state = currentUrl.searchParams.get('state') ?? 'state'\n\n  const appid = import.meta.env.VITE_APP_WX_APP_ID\n\n  const redirect_uri = currentUrl.href\n\n  const wxAuthUrl = new URL('https://open.weixin.qq.com/connect/oauth2/authorize')\n  wxAuthUrl.searchParams.set('appid', appid)\n  wxAuthUrl.searchParams.set('redirect_uri', redirect_uri)\n  wxAuthUrl.searchParams.set('response_type', 'code')\n  wxAuthUrl.searchParams.set('scope', 'snsapi_userinfo')\n  wxAuthUrl.searchParams.set('state', state)\n  wxAuthUrl.hash = 'wechat_redirect'\n\n  window.location.href = wxAuthUrl.href\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},2790:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(758);const s={},o=r.createContext(s);function a(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);